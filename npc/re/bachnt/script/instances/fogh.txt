
glast_01,244,290,0	script	#gh_fall_ev_00	HIDDEN_WARP_NPC,3,3,{
	end;
	
OnTouch:
	if(BaseLevel >= 130){
		cloaknpc("Oscar#gh_fall",false,getcharid(0));
		if(isbegin_quest(12458) == 2){
			cloaknpc("OSC1198#edda_fogh",false,getcharid(0));
			cloaknpc("OSC1127#edda_fogh",false,getcharid(0));
			cloaknpc("OSC1052#edda_fogh",false,getcharid(0));
			specialeffect EF_YELLOBODY,AREA,"OSC1198#edda_fogh";
			specialeffect EF_YELLOBODY,AREA,"OSC1127#edda_fogh";
			specialeffect EF_YELLOBODY,AREA,"OSC1052#edda_fogh";
			specialeffect EF_WHITEBODY,AREA,"OSC1198#edda_fogh";
		    specialeffect EF_WHITEBODY,AREA,"OSC1127#edda_fogh";
			specialeffect EF_WHITEBODY,AREA,"OSC1052#edda_fogh";
		}
	}
end;
}

glast_01,241,290,5	script	Oscar#gh_fall	4_ED_OSCAR,{
	if(isbegin_quest(12457) == 0){
		cutin "oscar02",2;
		mes "[ Oscar ]";
		mes "Oh! You can see me?";
		emotion ET_BIGTHROB;
		next;
		select("Yes, you look normal.");
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "Huh, how many times have you been in and out of the dimensional gap?";
		next;
		mes "[ Oscar ]";
		mes "Hehehe~";
		mes "Oh! Really! You see, I can smell people who had been into other dimensions.";
		next;
		select("I think you're smelling yourself.");
		cutin "oscar02",2;
		mes "[ Oscar ]";
		mes "It's definitely you. The people in the dimensional gap have no smell.";
		next;
		select("Who are you?");
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "You can call me ^0000CDOscar^000000.";
		mes "It's a hobby of mine to collect records from people that had been in and out of the dimensional gap.";
		next;
		mes "[ Oscar ]";
		mes "I was visiting my favorite time and space, I was about to leave but I was quite surprised to see you stare at me.";
		next;
		select("Sorry if I interrupted you.:I'm busy.");
		mes "[ Oscar ]";
		mes "Wait. How many times did you travel? Do you have a lot of experience? Where is the most impressive dimensional gap you've been to?";
		next;
		select("Please ask one question at a time.");
		cutin "oscar05",2;
		mes "[ Oscar ]";
		mes "Ah... I'm sorry. It's the first time I've met someone else with dimensional travel experience other than myself.";
		next;
		mes "[ Oscar ]";
		mes "I often speak with wise men like Varmundt, but even if I try to speak to him about this stuff...";
		next;
		select("Does Varmundt give you a hard time?");
		cutin "oscar04",2;
		mes "[ Oscar ]";
		mes "Yes, I try not to get too involve.";
		mes "I want to stay polite. I haven't talked to him much about dimensional travels.";
		next;
		cutin "",255;
		mes "[ "+strcharinfo(0)+" ]";
		mes "I don't know you well, but I know one thing for sure. You sure make some funny jokes.";
		next;
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "That's quite normal though. It's no wonder that sages are shy when they're 500 year old.";
		next;
		select("Wait, what did you just say?");
		cutin "oscar02",2;
		mes "[ Oscar ]";
		mes "What? That sages are very shy...?";
		next;
		select("No, not that...");
		select("What about the rest?");
		mes "[ Oscar ]";
		mes "My thoughts are quite complex and hard to follow sometimes. Is it hot? I thought it was cold.";
		next;
		select("500 years old...");
		mes "[ Oscar ]";
		mes "Yes. Why are you suddenly like that?";
		next;
		select("Are you making fun of me?");
		cutin "oscar03",2;
		mes "[ Oscar ]";
		mes "Yeah, I always do that! I was about to observe time and space. Wait?! Why are you lying on the floor?!";
		next;
		select("Can you introduce yourself again?");
		cutin "oscar02",2;
		mes "[ Oscar ]";
		mes "Ah, you're an adventurer!";
		mes strcharinfo(0) + ". Now get up, it's time to go to my favorite time and space.";
		next;
		mes "[ Oscar ]";
		mes "Do you want to visit a dimensional gap you've never seen before?";
		next;
		select("Please show me, I'd be honored.");
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "Good. I'm going to see the Fall of Glast Heim. I'm glad that you decided to go along with me.";
		next;
		select("Agree with him.");
		mes "[ Oscar ]";
		mes "I knew you'd be happy. Then get ready and help me open the dimensional gap.";
		setquest 12457;
		close3;
	}
	if(isbegin_quest(12457) == 1){
		.@md_name$ = "Glastheim Fall";
		.@party_id = getcharid(1);
		getpartymember .@party_id,3;
		if(!.@party_id || $@partymembercount != 1 || is_party_leader() == false){
			cutin "oscar01",2;
			mes "[ Oscar ]";
			mes "I can only activate it for you adventurer. Please create a party of your own and talk to me again.";
			close3;
		}
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "Are you mentally ready? Focus your energy on my hand to follow me.";
		emotion ET_BIGTHROB;
		next;
		.@s = select(((instance_id(IM_PARTY))?"":"Create a Dimensional Gap."),((instance_id(IM_PARTY))?"Enter the Dimensional Gap.":""));
		switch(.@s){
			case 1:
				switch(instance_create(.@md_name$)){
					case -1:
						mes "[ Oscar ]";
						mes "Unknown Error Has Occurred.";
						close3;
						
					case -2:
						mes "[ Oscar ]";
						mes "I can only activate it for you adventurer. Please create a party of your own and talk to me again.";
						close3;
						
					case -3:
						mes "[ Oscar ]";
						mes "Oh, it seems you still have an active dimensional gap.";
						mes "Let's wait for it to fade away.";
						close3;
						
					case -4:
						mes "[ Oscar ]";
						mes "Instance reservation is full at the moment. Try again later.";
						close3;
						
					default:
						mes "[ Oscar ]";
						mes "We succesfully created the dimensional gap. Talk to me again to enter the dimensional gap.";
						close3;
				}
				
			case 2:
				switch(instance_enter(.@md_name$)){
					case IE_OTHER:
						mes "An unknown error has occurred.";
						end;
						
					case IE_NOINSTANCE:
						mes "^ff0000Character doesn't have an instance reserved.^000000";
						end;
						
					case IE_NOMEMBER:	
						mes "Only registered members can enter the " + .@md_name$ + " instance.";
						end;
						
					case IE_OK:
						mapannounce "glast_01", strcharinfo(0) + " of the party, "+ .@party_name$ +", is entering the " + .@md_name$ + ".", bc_map, "0x00FF99";
						end;
				}			
		}
	}
	if(isbegin_quest(12458) == 0){
		cutin "oscar05",2;
		mes "[ Oscar ]";
		mes "Unfortunately, there was no way to stop Schmidt from being swallowed by the orb.";
		next;
		select("Was the orb destroyed?");
		mes "[ Oscar ]";
		mes "Yes. After the incident, the orb was definitely stopped and there was no more sinister energy that drains the energy of the living. That's the good thing.";
		next;
		cutin "oscar04",2;
		mes "[ Oscar ]";
		mes "But stopping the orb's energy didn't stop the energy of death that covered the area.";
		next;
		cutin "oscar05",2;
		mes "[ Oscar ]";
		mes "Schmidt's memory fragment started to appear here and there.";
		next;
		select("So what happened to Schmidt...");
		cutin "oscar04",2;
		mes "[ Oscar ]";
		mes "I looked at whether or not Schmidt's soul remained inside the orb, I couldn't find his soul, perhap he entirely disappeared.";
		next;
		mes "[ Oscar ]";
		mes "However, Schmidt's commitment and beliefs were transformed into a political weakness for other rules of Midgard.";
		next;
		select("Why political...");
		cutin "oscar05",2;
		mes "[ Oscar ]";
		mes "The rumors spread very fast, the act of throwing your own body to save the lives of others turned into the fall of the king into madness.";
		next;
		mes "[ Oscar ]";
		mes "In the records, King Schmidt is mentioned as a king who became crazy and greedy for wealth.";
		next;
		cutin "oscar04",2;
		mes "[ Oscar ]";
		mes "I guess the real soul of Schmidt is alive somewhere. In my dimensional journeys, King Schmidt's thoughts fell ten of thousands of times.";
		next;
		mes "[ Oscar ]";
		mes "Collecting and exploring the traces from the corpses might someday reveal what truly happened to King Schmidt's soul...";
		next;
		select("Why do you go so far?");
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "First of all, I want you to know this, but I don't cherish life and its preciousness the same way as other sages.";
		next;
		mes "[ Oscar ]";
		mes "I don't want to believe that sacrificing yourself is a noble action.";
		next;
		mes "[ Oscar ]";
		mes "I, Oscar, who controls the time and records. My mission is to go into different time and space.";
		next;
		select("Can I help in anyway?");
		cutin "oscar02",2;
		mes "[ Oscar ]";
		mes "Hmm... Maybe there's something you can be of help with.";
		next;
		cutin "oscar01",2;
		mes "[ Oscar ]";
		mes "We can purify Schmidt's beliefs by collecting crystal and the debris. Of course, I'm collecting them by myself, but the more the better.";
		next;
		mes "[ Oscar ]";
		mes "Ah. Let me introduce you to these machines in front of me. Putting the right crystals in them will reflect my will so you can trade them for enchants and other stuffs.";
		next;
		cloaknpc("OSC1198#edda_fogh",false,getcharid(0));
		cloaknpc("OSC1127#edda_fogh",false,getcharid(0));
		cloaknpc("OSC1052#edda_fogh",false,getcharid(0));
		select("I don't know how to do that.");
		cutin "oscar03",2;
		mes "[ Oscar ]";
		mes "It's called the sage's power. In any case, speak to me whenever you want. I'll open the dimension to purify his soul.";
		setquest 12458;
		completequest 12458;
		close3;
	}
	cutin "oscar03",2;
	mes "[ Oscar ]";
	mes "Is your mind all set? Then, please put your hand on my hand and concentrate.";
	next;
	switch(checkquest(12460,PLAYTIME)){
		case -1:
			.@normal = true;
			break;
			
		case 0:
		case 1:
			break;
			
		case 2:
			erasequest 12460;
			.@normal = true;
			break;
	}
	switch(checkquest(12461,PLAYTIME)){
		case -1:
			.@hard = true;
			break;
			
		case 0:
		case 1:
			break;
			
		case 2:
			erasequest 12461;
			.@hard = true;
			break;
	}
	if(.@normal == false && .@hard == false){
		cutin "oscar03",2;
		mes "[ Oscar ]";
		mes "^0000CDWe've purified enough for today.^000000 You need to rest up your body to do another dimensional travel. Come back again at dawn, adventurer.";
		close3;	
	}
	switch(select("Enter",((is_party_leader() == true && .@normal == true)?"Create Glastheim Purification":""),((is_party_leader() == true && BaseLevel >= 180 && .@hard == true)?"Create Glastheim Purification Hard":""))){
		case 1:
			if(select("Purification of Glastheim",((BaseLevel >= 180)?"^CC0000Purification of Glastheim Hard^000000":"")) == 1){
				.@md_name$ = "Glastheim Purification";
				.@cooldown = 12460;
				.@hunt = 12459;
				.@check = .@normal;
			} else {
				.@md_name$ = "Glastheim Purification Hard";
				.@cooldown = 12461;
				.@hunt = 12462;
				.@check = .@hard;
			}
			if(!.@check){
				cutin "oscar03",2;
				mes "[ Oscar ]";
				mes "^0000CDWe've purified enough for today.^000000 You need to rest up your body to do another dimensional travel. Come back again at dawn, adventurer.";
				close3;
			}
			switch(instance_enter(.@md_name$)){
				case IE_OTHER:
					mes "An unknown error has occurred.";
					close3;
					
				case IE_NOINSTANCE:
					mes "^ff0000Character doesn't have an instance reserved.^000000";
					close3;
					
				case IE_NOMEMBER:	
					mes "Only registered members can enter the " + .@md_name$ + " instance.";
					close3;
					
				case IE_OK:
					mapannounce "glast_01", strcharinfo(0) + " of the party, "+ .@party_name$ +", is entering the " + .@md_name$ + ".", bc_map, "0x00FF99";
					if(isbegin_quest(.@hunt))
						erasequest .@hunt;
					setquest .@hunt;
					setquest .@cooldown;
					end;
			}	
			
		case 2:
			.@party_id = getcharid(1);
			if(!.@party_id){
				mes "[ Oscar ]";
				mes "I can only activate it for you adventurer. Please create a party of your own and talk to me again.";
				close3;
			}
			.@md_name$ = "Glastheim Purification";
			switch(instance_create(.@md_name$)){
				case -1:
					mes "[ Oscar ]";
					mes "Unknown Error Has Occurred.";
					close3;
					
				case -2:
					mes "[ Oscar ]";
					mes "I can only activate it for you adventurer. Please create a party of your own and talk to me again.";
					close3;
					
				case -3:
					mes "[ Oscar ]";
					mes "Oh, it seems you still have an active dimensional gap.";
					mes "Let's wait for it to fade away.";
					close3;
					
				case -4:
					mes "[ Oscar ]";
					mes "Instance reservation is full at the moment. Try again later.";
					close3;
					
				default:
					mes "[ Oscar ]";
					mes "We succesfully created the dimensional gap. Talk to me again to enter the dimensional gap.";
					close3;
			}
			
		case 3:
			.@party_id = getcharid(1);
			if(!.@party_id){
				mes "[ Oscar ]";
				mes "I can only activate it for you adventurer. Please create a party of your own and talk to me again.";
				close3;
			}
			.@md_name$ = "Glastheim Purification Hard";
			switch(instance_create(.@md_name$)){
				case -1:
					mes "[ Oscar ]";
					mes "Unknown Error Has Occurred.";
					close3;
					
				case -2:
					mes "[ Oscar ]";
					mes "I can only activate it for you adventurer. Please create a party of your own and talk to me again.";
					close3;
					
				case -3:
					mes "[ Oscar ]";
					mes "Oh, it seems you still have an active dimensional gap.";
					mes "Let's wait for it to fade away.";
					close3;
					
				case -4:
					mes "[ Oscar ]";
					mes "Instance reservation is full at the moment. Try again later.";
					close3;
					
				default:
					mes "[ Oscar ]";
					mes "We succesfully created the dimensional gap. Talk to me again to enter the dimensional gap.";
					close3;
			}		
	}
}

glast_01,241,296,5	script	OSC1198#edda_fogh	2_DROP_MACHINE,{
	disable_items;
	mes "[ OSC1198 ]";
	mes "I can dismantle your unnecessary Glastheim's Fall artifact and partially return it as materials.";
	next;
	switch(select("Cancel:Armor:Garment:Left Accessory")){
		case 1:
			mes "[ OSC1198 ]";
			mes "Wise decision. Think about it carefully.";
			end;
			
		case 2:
			.@slot = EQI_ARMOR;
			.@equip_id = getequipid(.@slot);
			.@bool = inarray(.equip_id,.@equip_id);
			break;
			
		case 3:
			.@slot = EQI_GARMENT;
			.@equip_id = getequipid(.@slot);
			.@bool = inarray(.equip_id,.@equip_id);
			break;
			
		case 4:
			.@slot = EQI_ACC_L;
			.@equip_id = getequipid(.@slot);
			.@bool = inarray(.insignia,.@equip_id);
			.@stone = 25740;
			break;
	}
	if(.@bool == -1){
		mes "[ OSC1198 ]";
		mes "Did you remove the equipment?";
		end;
	}
	for(.@i = 0; .@i < 4; .@i++){
		.@card[.@i] = getequipcardid(.@slot,.@i);
		.@check[.@i] = .@card[.@i];
	}
	.@refine = getequiprefinerycnt(.@slot);
	.@enchant_count = ((.@card[1] > 0 ? 3 : (.@card[2] > 0 ? 2 : (.@card[3] > 0 ? 1 : 0))));
	if(!.@stone)
		.@stone = 25739;	
	switch(.@enchant_count){
		case 0:
			mes "[ OSC1198 ]";
			mes "Your equipment must atleast have one enchant to get a partial refund.";
			end;
			
		case 1:
			if(.@stone == 25739){
				.@min = 3;
				.@max = 6;
			} else {
				.@min = 2;
				.@max = 6;
			}
			break;
			
		case 2:
			if(.@stone == 25739){
				.@min = 6;
				.@max = 10;
			} else {
				.@min = 4;
				.@max = 12;
			}
			break;
			
		case 3:
			if(.@stone == 25739){
				.@min = 9;
				.@max = 15;
			} else {
				.@min = 6;
				.@max = 18;
			}
			break;					
	}
	mes "[ OSC1198 ]";
	mes "Are you sure you want to dismantle the ^CC0000" + getitemname(.@equip_id) + "^000000 that you currently have equipped?";
	next;
	if(select("No.:Please stop!:Yes, I'm sure.") < 3){
		mes "[ OSC1198 ]";
		mes "Wise decision. Think about it carefully.";
		end;
	}
	if(callfunc("F_IsEquipIDHack", .@slot, .@equip_id) || callfunc("F_IsEquipRefineHack", .@slot, .@refine) || callfunc("F_IsEquipCardHack", .@slot, .@check[0], .@check[1], .@check[2], .@check[3]))
		end;
	mes "[ OSC1198 ]";
	mes "Dismantling the equipment...";
	progressbar_npc "00FF00",2;
	delequip .@slot;
	mes "Your equipment has been succesfully processed.";
	callfunc "getitemclone",.@stone,rand(.@min,.@max);
	if(rand(1,100) <= .chance){
		next;
		.@costume_id = .drooping_id[rand(getarraysize(.drooping_id))];
		mes "[ OSC1198 ]";
		mes "*Pi-pi-ping*";
		mes "It's your lucky day... I have succesfully created a memento out of the equipment that you recycled.";
		callfunc "getitemclone",.@costume_id,1;
	}
	end;
	
OnInit:
	cloaknpc(strnpcinfo(0),true);
	setarray .equip_id,15388,15389;
	setarray .insignia,32228,32229,32230,32231,32232,32233;
	setarray .drooping_id,31631,31632,31633;
	.chance = 3; //Chance to get a drooping costume
	setunittitle getnpcid(0),"[Dismantle Machine]";
end;
}

glast_01,243,296,5	script	OSC1127#edda_fogh	2_SLOT_MACHINE,{
	disable_items;
	mes "[ OSC1127 ]";
	mes "If you want to strengthen your Glastheim's Fall artifacts, then you're at the correct machine. Select the artifact that you want to enchance.";
	next;
	switch(select("Cancel:Armor:Garment:Left Accessory")){
		case 1:
			mes "[ OSC1127 ]";
			mes "Come back again when you have decided.";
			end;
			
		case 2:
			.@part = EQI_ARMOR;
			.@equip_id = getequipid(.@part);
			.@bool = inarray(.equip_id,.@equip_id);
			setarray .@requirement,25739,5,6608,10;
			
			break;
			
		case 3:
			.@part = EQI_GARMENT;
			.@equip_id = getequipid(.@part);
			.@bool = inarray(.equip_id,.@equip_id);
			setarray .@requirement,25739,5,6608,10;
			break;
			
		case 4:
			.@part = EQI_ACC_L;
			.@equip_id = getequipid(.@part);
			.@bool = inarray(.insignia,.@equip_id);
			setarray .@requirement,25740,10,6755,40;
			break;
	}
	if(.@bool == -1){
		mes "[ OSC1127 ]";
		mes "Did you remove the equipment?";
		end;
	}
	.@refine = getequiprefinerycnt(.@part);
	.@equip_name$ = getitemname(.@equip_id);
	for(.@i = 0; .@i < 4; .@i++){
		.@card[.@i] = getequipcardid(.@part,.@i);
		.@check[.@i] = .@card[.@i];
	}
	if(.@card[1] > 0){
		mes "[ OSC1127 ]";
		mes "Your equipment is already enchanted to the limit.";
		end;
	}
	.@slot = ((.@card[3] == 0 ? 3 : (.@card[2] == 0 ? 2 : 1)));
	switch(.@slot){
		case 1:
			if(.@part == EQI_ARMOR)
				setarray .@enchant_list,4702,4712,4722,4732,4742,4752,29302,29303,29304,29305,29306,29307,29308,29309;
			else if(.@part == EQI_GARMENT)
				setarray .@enchant_list,4808,4820,4821,4813,4812,4826,4817,4816,4843,4834,4835,4836,4863,4864,4865;
			else {
				setarray .@enchant_list,29587,29588,29589,29590,29591,29592;
				.@break = 30;
			}
			.@word$ = "Final";
			break;
			
		case 2:
			if(.@part == EQI_ARMOR)
				setarray .@enchant_list,4702,4703,4704,4712,4713,4714,4722,4723,4724,4732,4733,4734,4742,4743,4744,4752,4753,4754;
			else if(.@part == EQI_GARMENT)
				setarray .@enchant_list,4808,4820,4821,4813,4812,4826,4817,4816,4843,4834,4835,4836,4863,4864,4865;
			else
				setarray .@enchant_list,4821,4822,4812,4826,4843,4844,4835,4836,4864,4865;
			.@word$ = "Second";
			break;
		
		case 3:
			if(.@part == EQI_ARMOR)
				setarray .@enchant_list,4702,4703,4704,4712,4713,4714,4722,4723,4724,4732,4733,4734,4742,4743,4744,4752,4753,4754;
			else if(.@part == EQI_GARMENT)
				setarray .@enchant_list,4808,4820,4821,4813,4812,4826,4817,4816,4843,4834,4835,4836,4863,4864,4865;
			else
				setarray .@enchant_list,4702,4703,4704,4712,4713,4714,4722,4723,4724,4732,4733,4734,4742,4743,4744,4752,4753,4754;
			.@word$ = "First";
			break;
	}
	mes "[ OSC1127 ]";
	mes "^0000CD" + .@equip_name$ + "^000000";
	mes "Slot : " + .@word$ + " Enchant";
	mes "Requirement : ";
	for(.@i = 0; .@i < getarraysize(.@requirement); .@i += 2){
		mes "^0000CD" + .@requirement[.@i+1] + " " + getitemname(.@requirement[.@i]) + "^000000";
		if(countitem(.@requirement[.@i]) < .@requirement[.@i+1])
			.@miss++;
	}
	if(.@break){
		mes "";
		mes "This item has a " + .@break + "% chance to break on adding the final slot, do you want to proceed?";
	}
	next;
	if(select("Cancel:Proceed") == 1){
	}
	if(.@miss){
		mes "[ OSC1127 ]";
		mes "You don't have enough material to proceed with the enchant.";
		end;
	}
	.@enchant = .@enchant_list[rand(getarraysize(.@enchant_list))];
	.@card[.@slot] = .@enchant;
	for(.@i = 0; .@i < getarraysize(.@requirement); .@i += 2)
		delitem .@requirement[.@i],.@requirement[.@i+1];
	if(rand(1,100) > .@break){
		mes "[ OSC1127 ]";
		mes "Your equipment has been successfully enchanted.";
		specialeffect2 EF_REPAIRWEAPON;
		delequip .@part;
		getitem2 .@equip_id,1,1,.@refine,0,.@card[0],.@card[1],.@card[2],.@card[3];
	} else {
		mes "[ OSC1127 ]";
		mes "Your equipment broke through the enchantment process.";	
		specialeffect2 EF_REFINEFAIL;
		delequip .@part;
	}
	end;
	
OnInit:
	setarray .equip_id,15388,15389;
	setarray .insignia,32228,32229,32230,32231,32232,32233;
	cloaknpc(strnpcinfo(0),true);
	setunittitle getnpcid(0),"[Enchant Machine]";
end;
}

glast_01,245,296,5	script	OSC1052#edda_fogh	2_VENDING_MACHINE1,{
	mes "[ OSC1052 ]";
	mes "You have preserved what's left of Glastheim's Fall.";
	mes "Select the item you desire to view it's information.";
	next;
	switch(select("Cancel:Armor:Garment:Left Accessory")){
		case 1:
			mes "[ OSC1052 ]";
			mes "Come back whenever you can. Those who jump through dimensions are always welcome.";
			end;
			
		case 2:
			.@item_id = .equip_id[0];
			setarray .@requirement,25739,5,6607,10;
			.@item$ = " Suit[1]";
			break;
			
		case 3:
			.@item_id = .equip_id[1];
			setarray .@requirement,25739,5,6607,10;
			.@item$ = " Manteau[1]";
			break;
			
		case 4:
			mes "[ OSC1052 ]";
			mes "Select the type of accessory that you desire.";
			next;
			setarray .@menu$,"Power","Divine Power","Hundred Lucks","Flash","Celestial";
			.@s = select("Power:Divine Power:Hundred Lucks:Flash:Celestial") - 1;
			.@item_id = .insignia[.@s];
			setarray .@requirement,25740,5,6755,5;
			.@item$ = " " + .@menu$[.@s] + " Insignia[1]";
			break;
	}
	mes "[ OSC1052 ]";
	mes "[<ITEM>King Schmidt's" + .@item$ + "<INFO>" + .@item_id + "</INFO></ITEM>]";
	mes "Requirement : ";
	for(.@i = 0; .@i < getarraysize(.@requirement); .@i += 2){
		mes "^0000CD" + .@requirement[.@i+1] + " " + getitemname(.@requirement[.@i]) + "^000000";
		if(countitem(.@requirement[.@i]) < .@requirement[.@i+1])
			.@miss++;
	}
	next;
	if(select("Cancel:Buy Equipment") == 1){
		mes "[ OSC1052 ]";
		mes "Come back whenever you can. Those who jump through dimensions are always welcome.";
		end;	
	}
	if(.@miss){
		mes "[ OSC1052 ]";
		mes "You don't have enough materials to buy this equipment.";
		end;
	}
	for(.@i = 0; .@i < getarraysize(.@requirement); .@i += 2)
		delitem .@requirement[.@i],.@requirement[.@i+1];
	mes "[ OSC1052 ]"; 
	mes "Here's your <ITEM>King Schmidt's" + .@item$ + "<INFO>" + .@item_id + "</INFO></ITEM>";
	callfunc "getitemclone",.@item_id,1;
	end;
	
OnInit:
	setarray .equip_id,15388,15389;
	setarray .insignia,32228,32229,32230,32231,32232,32233;
	cloaknpc(strnpcinfo(0),true);
	setunittitle getnpcid(0),"[Exchange Machine]";
end;
}

1@gl_prq,1,1,0	script	#gh_fall_control	-1,{
	end;

OnInstanceInit:
	set_instance_var("map$",instance_mapname("1@gl_prq"));
	.@type$ = instance_live_info(ILI_NAME);
	instance_enable("#edda_fence_0",false);
	instance_enable("#edda_warp_0",false);
	instance_enable("Orb#edda_fall_0",false);
	instance_enable("#gh_purification_ev_0",false);
	instance_enable("#gh_purification_mob",false);
	instance_enable("#gh_purification_boss",false);
	instance_enable("#gh_purification_fire",false);
	instance_enable("#schmidt_gh_purification",false);
	
	for(.@i = 0; .@i < 2; .@i++)
		instance_enable("Heinrich#gh_fall_" + .@i,false);
	for(.@i = 0; .@i < 3; .@i++){
		instance_enable("Oscar#gh_fall_" + .@i,false);
		instance_enable("#gh_fall_ev_" + .@i,false);
	}
	for(.@i = 0; .@i < 4; .@i++)
		instance_enable("Varmundt#gh_fall_" + .@i,false);
	for(.@i = 0; .@i < 5; .@i++){
		instance_enable("Schmidt#gh_fall_" + .@i,false);
		instance_enable("Oscar#gh_purification_" + .@i,false);
	}
	for(.@i = 0; .@i < 8; .@i++)
		instance_enable("Knight Survivor#gh_fall_" + .@i,false);
	for(.@i = 0; .@i < 16; .@i++)
		instance_enable("Victim#gh_fall_" + .@i,false);
	for(.@i = 0; .@i < 44; .@i++)
		instance_enable("#schmidt_dummy_" + .@i,false);
	
	//= Fall of Glastheim
	if(.@type$ == "Glastheim Fall"){
		instance_enable("#gh_fall_ev_0",true);
		for(.@i = 0; .@i < 4; .@i++){
			instance_enable("Varmundt#gh_fall_" + .@i,true);
			instance_hide("Varmundt#gh_fall_" + .@i,true);
		}
		for(.@i = 0; .@i < 5; .@i++){
			instance_enable("Schmidt#gh_fall_" + .@i,true);
			instance_hide("Schmidt#gh_fall_" + .@i,true);
		}
		for(.@i = 0; .@i < 2; .@i++){
			instance_enable("Heinrich#gh_fall_" + .@i,true);
			instance_hide("Heinrich#gh_fall_" + .@i,true);
		}
		for(.@i = 0; .@i < 6; .@i++){
			instance_enable("#gh_fall_guard_" + .@i,true);
			instance_hide("#gh_fall_guard_" + .@i,true);
		}
		for(.@i = 0; .@i < 3; .@i++){
			instance_enable("Oscar#gh_fall_" + .@i,true);
			instance_hide("Oscar#gh_fall_" + .@i,true);
		}
		for(.@i = 0; .@i < 44; .@i++){
			instance_enable("#schmidt_dummy_" + .@i,true);
			instance_hide("#schmidt_dummy_" + .@i,true);
		}
		end;
	}
	if(.@type$ == "Glastheim Purification"){	
		set_instance_var("maid",20392);
		set_instance_var("khalitzburg",20388);
		set_instance_var("knight",20390);
		set_instance_var("bloody",20394);
		set_instance_var("schmidt",20386);
		set_instance_var("hunt",12459);
	} else {
		set_instance_var("mode",1);
		set_instance_var("maid",20392);
		set_instance_var("khalitzburg",20389);
		set_instance_var("knight",20391);
		set_instance_var("bloody",20394);
		set_instance_var("schmidt",20387);	
		set_instance_var("hunt",12462);
	}
	instance_enable("#gh_purification_ev_0",true);
	instance_enable("Oscar#gh_purification_0",true);
	instance_enable("#gh_purification_mob",true);
	instance_enable("#gh_purification_boss",true);
	instance_enable("#gh_purification_fire",true);
	instance_event("#gh_purification_mob","OnSpawn00",false);
end;
}


1@gl_prq,299,17,0	script	#gh_fall_ev_0	HIDDEN_WARP_NPC,3,2,{
	end;
	
OnTouch:
	.@var = get_instance_var("gh_fall");
	set_instance_var("gh_fall",0);
	if(.@var == 0){
		set_instance_var("gh_fall",1);
		instance_enable(strnpcinfo(0),false);
		instance_hide("Varmundt#gh_fall_0",false);
		specialeffect EF_YELLOBODY,AREA,instance_npcname("Varmundt#gh_fall_0");
		specialeffect EF_WHITEBODY,AREA,instance_npcname("Varmundt#gh_fall_0");
	}
end;
}

1@gl_prq,299,30,4	script	Varmundt#gh_fall_0	4_M_BARMUND,5,4,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 2){
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "Please go back. This place is changing into a place where living beings cannot enter.";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "Sage. What happened here?";
		mes "I cancelled all my plans to come back here as soon as possible. Where is Heinrich?";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "As you can see, the curse of Himmelmez is spreading throughout the castle. It's extremely dangerous to go inside now.";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "However, there are many people who have not evacuated yet.";
		mes "Shouldn't we focus on that first?";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "Lord Heinrich has already started.";
		mes "What you should do now is remedy the situation after the evacuation, not recklessly dive into the castle.";
		next;
		cutin "schmidt03",0;
		mes "[ Schmidt ]";
		mes "You're right, but there are other reasons I want to go inside the castle.";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "I know a few things about this type of curse. Perhaps the catalyst is within the castle. If we don't destroy it...";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "You mentioned the curse, but not the reason of it.";
		next;
		cutin "schmidt06",0;
		mes "[ Schmidt ]";
		mes "What is then? Do you know the energy source?!";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "I'll explain more about it later.";
		mes "Wouldn't you want to wait for me to be physically here?";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "You know it's not like that.";
		mes "I am the king of this continent and the owner of this castle. It's my duty to amend the current situation.";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "I know better than anyone, young king.";
		mes "I know that there is no lie nor hesitation in your heart.";
		next;
		mes "[ Varmundt's Illusion ]";
		mes "But your life is not only yours, it's the life of this continent itself, please go back.";
		next;
		cutin "schmidt03",0;
		mes "[ Schmidt ]";
		mes "Sage... I'm sorry, but I have to go.";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "Can you please tell me more about the situation?";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "I want to tell you a little bit more, but since I'm pursuing Himmelmez, I can't afford to tell you right now.";
		next;
		mes "[ Varmundt's Illusion ]";
		mes "I'll tell you one thing is for certain. If you go back now, you can have faith in my abilities and be at rest.";
		next;
		mes "[ Varmundt's Illusion ]";
		mes "Of course, I cannot guarantee the lives of everyone in the castle, that cannot be helped.";
		next;
		cutin "schmidt06",0;
		mes "[ Schmidt ]";
		mes "My subordinates are my people. I want everyone to survive. I won't hear that story again!";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "I am going.";
		next;
		cutin "gl_barmund3",2;
		mes "[ Varmundt's Illusion ]";
		mes "Wait, young king! You must not go carelessly like that!";
		close2;
		cutin "",255;
		.@var = get_instance_var("gh_fall");
		if(.@var == 2){
			set_instance_var("gh_fall",3);
			.@mercenary = getmercinfo(8);
			if(.@mercenary != 0){
				if(unitexists(.@mercenary))
					unitkill .@mercenary;
			}
			instance_hide("Schmidt#gh_fall_0",true);
			instance_enable("Schmidt#gh_fall_0",false);
			instance_hide("Oscar#gh_fall_0",false);
			mercenary_create 20385,300000;
		}
		end;
	}
	if(.@var == 3){
		cutin "gl_barmund3",2;
		mes "[ Varmundt's Illusion ]";
		mes "Wait, young king! You must not go carelessly like that!";
		close3;
	}
	end;
	
OnTouch:
	specialeffect EF_YELLOBODY;
	.@var = get_instance_var("gh_fall");
	if(.@var == 1){
		set_instance_var("gh_fall",2);
		instance_hide("Schmidt#gh_fall_0",false);
		npctalk "Stop right there, Schmidt. This is not a place for you to simply jump in at any moment.";	
	}
end;
}

1@gl_prq,299,25,0	script	Schmidt#gh_fall_0	4_ED_SCHMIDT,{
	cutin "schmidt02",0;
	mes "[ Schmidt ]";
	mes "I'm talking to the sage. Please wait a moment...";
	close3;
}

1@gl_prq,280,32,3	script	Oscar#gh_fall_0	4_ED_OSCAR,3,3,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 3){
		cutin "oscar01",0;
		mes "[ Oscar ]";
		mes "What if someone sees me?";
		mes "Don't worry. My body has a dimensional barrier so that only you can see me.";
		next;
		mes "[ Oscar ]";
		mes "How about you? Do you think there's a way to change the course of history and bring these people out of a tragedy?";
		next;
		cutin "oscar05",0;
		mes "[ Oscar ]";
		mes "After all, the fate of these people are drastic.";
		next;
		mes "[ Oscar ]";
		mes "It's a future without dreams nor hope. A painful, distorted story.";
		mes "Wherever you look, there's not a glimpse of hope.";
		next;
		mes "[ Oscar ]";
		mes "Of course, what I really wanted is a happy ending, so I actually tried to change my own destiny a few times.";
		next;
		cutin "oscar01",0;
		mes "[ Oscar ]";
		mes "What I said was a joke?!";
		mes "You never take me too seriously aren't you?";
		next;
		cutin "oscar02",0;
		mes "[ Oscar ]";
		mes "Anyway. In my opinion, King Schmidt's military decision was left to be desired...";
		next;
		mes "[ Oscar ]";
		mes "It was tactically correct, but it failed strategically.";
		next;
		mes "[ Oscar ]";
		mes "You'll see it yourself anyway, but that's why Varmundt tried to prevent him from entering.";
		next;
		cutin "oscar05",0;
		mes "[ Oscar ]";
		mes "Poor Schmidt...";
		next;
		mes "[ Oscar ]";
		mes "I always think about how different the story would have been if he had been a little more selfish.";
		next;
		cutin "oscar01",0;
		mes "[ Oscar ]";
		mes "I'm moving. There are still events to witness!";
		close2;
		cutin "",255;
		set_instance_var("gh_fall",4);
		instance_enable("#gh_fall_ev_1",true);
		for(.@i = 0; .@i < 16; .@i++)
			instance_enable("Victim#gh_fall_" + .@i,true);	
		end;
	}
	cutin "oscar01",0;
	mes "[ Oscar ]";
	mes "I'm moving. There are still events to witness!";
	close3;
	
OnTouch:
	.@var = get_instance_var("gh_fall");
	if(.@var == 3)
		npctalk "Oh~ Did you have a good conversation with Varmundt?";
	if(.@var == 4)
		npctalk "Go ahead. It shouldn't take much to see the following events.";
end;
}

1@gl_prq,273,49,0	script	#gh_fall_ev_1	HIDDEN_WARP_NPC,4,3,{
	end;
	
OnTouch:
	.@var = get_instance_var("gh_fall");
	if(.@var == 4){
		set_instance_var("gh_fall",5);
		instance_hide(strnpcinfo(0),true);
		instance_enable(strnpcinfo(0),false);
		.@mercenary = getmercinfo(8);
		if(.@mercenary != 0){
			if(unitexists(.@mercenary))
				unitkill .@mercenary;
		}
		instance_enable("Schmidt#gh_fall_1",true);
		instance_hide("Schmidt#gh_fall_1",false);
		npctalk "Wait. Aren't my soldiers in the front?",instance_npcname("Schmidt#gh_fall_1");
	}
end;
}

1@gl_prq,273,51,7	script	Schmidt#gh_fall_1	4_ED_SCHMIDT,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 5){
		cutin "schmidt02",2;
		mes "[ Schmidt ]";
		mes "There seems to be people who haven't evacuated yet. I have to tell them to return outside.";
		npctalk "Schmidt : You took your time. Aren't my soldiers the one ahead of me?";
		next;
		select("Please go back now.:You have orders.");
		mes "[ Schmidt ]";
		mes "No I can't. I won't go back...";
		next;
		mes "[ Schmidt ]";
		mes "I'm sorry, but I need you to help me. I need your help on finding the rest of the survivors.";
		next;
		mes "[ Schmidt ]";
		mes "There's a chance that they'll attack you if you're not with me. I think they've lost already half their sanity...";
		next;
		mes "[ Schmidt ]";
		mes "I'll met you again when our path crosses.";
		close2;
		cutin "",255;
		set_instance_var("gh_fall",6);
		.@mercenary = getmercinfo(8);
		if(.@mercenary != 0){
			if(unitexists(.@mercenary))
				unitkill .@mercenary;
		}
		instance_hide(strnpcinfo(0),true);
		instance_enable(strnpcinfo(0),true);
		instance_enable("#edda_fence_0",true);
		mercenary_create 20385,300000;
		for(.@i = 0; .@i < 8; .@i++)
			instance_enable("Knight Survivor#gh_fall_" + .@i,true);
	}
	end;
}

1@gl_prq,283,54,3	script	Victim#gh_fall_0	4_TOWER_06,5,5,{
	end;
	
OnTouch:
	specialeffect EF_VENOMDUST;
	instance_hide(strnpcinfo(0),true);
	instance_enable(strnpcinfo(0),false);
	getmapxy(.@map$,.@x,.@y,BL_NPC);
	monster .@map$,.@x,.@y,"Maggot",2467,1;
end;
}

1@gl_prq,287,78,4	duplicate(Victim#gh_fall_0)	Victim#gh_fall_1	4_TOWER_08,5,5
1@gl_prq,294,94,2	duplicate(Victim#gh_fall_0)	Victim#gh_fall_2	4_TOWER_11,5,5
1@gl_prq,291,132,5	duplicate(Victim#gh_fall_0)	Victim#gh_fall_3	4_TOWER_13,5,5
1@gl_prq,295,149,4	duplicate(Victim#gh_fall_0)	Victim#gh_fall_4	4_TOWER_03,5,5
1@gl_prq,283,152,2	duplicate(Victim#gh_fall_0)	Victim#gh_fall_5	4_TOWER_01,5,5
1@gl_prq,278,146,3	duplicate(Victim#gh_fall_0)	Victim#gh_fall_6	4_TOWER_06,5,5
1@gl_prq,289,167,6	duplicate(Victim#gh_fall_0)	Victim#gh_fall_7	4_TOWER_08,5,5
1@gl_prq,284,176,8	duplicate(Victim#gh_fall_0)	Victim#gh_fall_8	4_TOWER_11,5,5
1@gl_prq,287,201,7	duplicate(Victim#gh_fall_0)	Victim#gh_fall_9	4_TOWER_13,5,5
1@gl_prq,297,209,1	duplicate(Victim#gh_fall_0)	Victim#gh_fall_10	4_TOWER_03,5,5
1@gl_prq,280,210,5	duplicate(Victim#gh_fall_0)	Victim#gh_fall_11	4_TOWER_01,5,5
1@gl_prq,299,267,7	duplicate(Victim#gh_fall_0)	Victim#gh_fall_12	4_TOWER_06,5,5
1@gl_prq,292,283,8	duplicate(Victim#gh_fall_0)	Victim#gh_fall_13	4_TOWER_08,5,5
1@gl_prq,285,294,8	duplicate(Victim#gh_fall_0)	Victim#gh_fall_14	4_TOWER_11,5,5
1@gl_prq,297,297,8	duplicate(Victim#gh_fall_0)	Victim#gh_fall_15	4_TOWER_13,5,5

1@gl_prq,290,51,7	script	Knight Survivor#gh_fall_0	4_F_KHALITZBURG,3,3,{
	end;
	
OnTouch:
	.@var = get_instance_var("gh_fall");
	if(.@var == 6){
		.@id = atoi(replacestr(strnpcinfo(2),"gh_fall_",""));
		unittalk getcharid(3),strcharinfo(0) + " : At the king's order. Please evacuate quickly.";
		setpcblock PCBLOCK_ALL,true;
		switch(.@id){
			case 0:
				.@mes$ = "Avoid the castle? Oh my king, you must not go inside. Please, avoid it.";
				break;
				
			case 1:
				.@mes$ = "A strange orb in the castle is sucking the life out of our people. All the people who came near it are turning undead.";
				break;
				
			case 2:
				.@mes$ = "The living are turning into undead. You have to avoid it. The knights are blocking the outer area, but it's the limit.";
				break;
				
			case 3:
				.@mes$ = "Ugh... I can feel my soul being eroded by the sound of the orb. Stay away from me.";
				break;
				
			case 4:
				.@mes$ = "It's not true that the knights inside the castle turned into monsters, right? I'm heading out.";
				break;
				
			case 5:
				.@mes$ = "Don't go in further, your highness! It's dangerous! Please come with me!";
				break;
				
			case 6:
				.@mes$ = "Leave me alone! Don't come near me!";
				break;
				
			case 7:
				.@mes$ = "I only take orders from his majesty, Schmidt!";
				break;
		}
		npctalk .@mes$;
		sleep2 3000;
		setpcblock PCBLOCK_ALL,false;
		instance_hide(strnpcinfo(0),true);
		instance_enable(strnpcinfo(0),false);
		set_instance_var("survivor",get_instance_var("survivor") + 1);
		if(.@id >= 6){
			getmapxy(.@map$,.@x,.@y,BL_NPC);
			monster .@map$,.@x,.@y,"Unreasonable Person",20388,1,instance_npcname(strnpcinfo(0)) + "::OnMobDead";
		}
		end;
	}
	
OnMobDead:
end;
}

1@gl_prq,295,102,5	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_1	4_F_KHALITZBURG,3,3
1@gl_prq,295,134,3	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_2	4_F_KHALITZBURG,3,3
1@gl_prq,287,156,4	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_3	4_F_KHALITZBURG,3,3
1@gl_prq,279,160,7	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_4	4_F_KHALITZBURG,3,3
1@gl_prq,278,165,6	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_5	4_F_KHALITZBURG,3,3
1@gl_prq,299,179,1	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_6	4_F_KHALITZBURG,3,3
1@gl_prq,300,193,2	duplicate(Knight Survivor#gh_fall_0)	Knight Survivor#gh_fall_7	4_F_KHALITZBURG,3,3

1@gl_prq,284,217,4	script	#edda_fence_0	4_ED_FENCE,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 6){
		if(get_instance_var("survivor") < 8){
			cutin "schmidt02",2;
			mes "[ Schmidt ]";
			mes "Adventurer. There seems to be more survivors nearby. Shouldn't we find them first?";
			close3;
		}
		cutin "schmidt02",2;
		mes "[ Schmidt ]";
		mes "The door is already worn out, so we'd better just break it down. Stand back a little, I'll take care of it.";
		close2;
		cutin "",255;
		set_instance_var("gh_fall",7);
		specialeffect EF_LORD;
		sleep2 3000;
		instance_hide(strnpcinfo(0),true);
		instance_enable("#edda_warp_0",true);
		mercenary_create 20385,300000;
	}
	end;
}

1@gl_prq,284,217,4	script	#edda_warp_0	WARPNPC,3,3,{
	end;
	
OnTouch:
	.@map$ = get_instance_var("map$");
	warp .@map$,284,229;
end;
}

1@gl_prq,286,247,7	script	Schmidt#gh_fall_2	4_ED_SCHMIDT,3,3,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 8){
		cutin "schmidt02",2;
		mes "[ Schmidt ]";
		mes "My vitality is slowly fading away as we get close. While we are standing here, this sinister energy is draining everyone's life and sanity away.";
		next;
		select("You must return now.");
		mes "[ Schmidt ]";
		mes "Going through the underground passage is difficult and the corridors above already collapsed. We don't have much time left.";
		next;
		mes "[ Schmidt ]";
		mes "Let's continue, and hurry as much as possible.";
		close2;
		cutin "",255;
		set_instance_var("gh_fall",9);
		instance_hide(strnpcinfo(0),true);
		mercenary_create 20385,300000;
		end;
	}
	end;
	
OnTouch:
	.@var = get_instance_var("gh_fall");
	if(.@var == 7){
		.@mercenary = getmercinfo(8);
		if(.@mercenary != 0){
			if(unitexists(.@mercenary))
				unitkill .@mercenary;
		}
		set_instance_var("gh_fall",8);
		instance_hide(strnpcinfo(0),false);
		npctalk "Schmidt : I have a bad feeling about this.";
	}
end;
}

1@gl_prq,297,294,5	script	Schmidt#gh_fall_3	4_ED_SCHMIDT,3,3,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 12){
		cutin "schmidt04",0;
		mes "[ Schmidt ]";
		mes "Heinrich! Tell me where the orb is.";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "King Schmidt! Now is not the time for this.";
		next;
		cutin "schmidt01",0;
		mes "[ Schmidt ]";
		mes "Master is the only sage in this continent. I'm worried about his standing.";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "But you're the king! The only king in this continent!";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "The king can be suceeded by someone else, but nobody can replace the sage, not until many centuries.";
		next;
		cutin "schmidt06",0;
		mes "[ Schmidt ]";
		mes "Can you imagine what will happen to the state of the continent if the sage suddenly disappeared?";
		mes "Who will bear the threats to this world and the threats from other dimensions?";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "This is my decision... guide me to where the sage went into, Heinrich. I'm sure you know the location.";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "It can't be helped.";
		next;
		cutin "heinrich_a02",2;
		mes "[ Heinrich ]";
		mes "I'll obey... your orders.";
		close2;
		cutin "",255;
		specialeffect EF_REDBODY;
		specialeffect EF_CLOAKING;
		specialeffect EF_REDBODY,AREA,instance_npcname("Heinrich#gh_fall_0");
		specialeffect EF_CLOAKING,AREA,instance_npcname("Heinrich#gh_fall_0");
		for(.@i = 0; .@i < 6; .@i++){
			instance_hide("#gh_fall_guard_" + .@i,true);
			instance_enable("#gh_fall_guard_" + .@i,false);
		}
		sleep 200;
		instance_hide("Oscar#gh_fall_1",false);
		sleep 1000;
		set_instance_var("gh_fall",13);
		npctalk "Oscar : The story hasn't changed this time either.",instance_npcname("Oscar#gh_fall_1");
		end;
	}
	if(.@var == 13){
		mes "^0000CDIt seems that I'm not in sync with this time and space. Starting a conversation won't work.";
		end;
	}
	end;
	
OnTouch:
	.@var = get_instance_var("gh_fall");
	if(.@var == 9){
		.@mercenary = getmercinfo(8);
		if(.@mercenary != 0){
			if(unitexists(.@mercenary))
				unitkill .@mercenary;
		}
		for(.@i = 0; .@i < 6; .@i++)
			instance_hide("#gh_fall_guard_" + .@i,false);
		instance_hide("Heinrich#gh_fall_0",false);
		instance_hide("Schmidt#gh_fall_3",false);
		set_instance_var("gh_fall",10);
		npctalk "Schmidt : Heinrich!",instance_npcname("Schmidt#gh_fall_3");
	}
end;
}

1@gl_prq,301,294,3	script	Heinrich#gh_fall_0	4_M_HEINRICH,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 10){
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "King Schmidt! I see that you've arrived.";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "Heinrich, I'm glad that you're safe!";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "I told the soldiers to take you outside when they meet you, but they didn't disobey my orders. You must be stubborn in order to come here your majesty...";
		next;
		cutin "schmidt05",0;
		mes "[ Schmidt ]";
		mes "Oh, it's been a while since we've last met and you're nagging me already Heinrich. It's nice to see you again.";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "King Schmidt, there's no time to spare. You must leave this place with me at once.";
		next;
		cutin "schmidt01",0;
		mes "[ Schmidt ]";
		mes "You're the same as the great sage, don't tell me to leave quickly. What is in the castle that's causing all of this?";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "...";
		next;
		cutin "schmidt02",0;
		mes "[ Schmidt ]";
		mes "Now, tell me. Heinrich, what's making you make me go as far as possible.";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "The cursed orb was located inside the castle, it's presumed to be a work of Himmelmez. I couldn't figure it out, but it's energy is getting stronger.";
		next;
		cutin "schmidt04",0;
		mes "[ Schmidt ]";
		mes "Right. I don't understand why you're asking me to evacuate.";
		next;
		cutin "schmidt01",0;
		mes "[ Schmidt ]";
		mes "But if the orb is the problem, I don't think it will be resolve by me evacuating, don't you think?";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt's Illusion ]";
		mes "Correct. It's meaningless to run away. It's a cursed object that endlessly drains the energy of the living.";
		close2;
		cutin "",255;
		instance_hide("Varmundt#gh_fall_1",false);
		npctalk "Heinrich : Varmundt!";
		npctalk "Schmidt : Master!",instance_npcname("Schmidt#gh_fall_3");
		set_instance_var("gh_fall",11);
		end;
	}
	if(.@var < 13){
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "(We have to evacuate Schmidt no matter what.)";
		close3;
	}
	mes "^0000CDIt seems that I'm not in sync with this time and space. Starting a conversation won't work.";
	end;
}

1@gl_prq,299,297,4	script	Varmundt#gh_fall_1	4_M_BARMUND,{
	.@var = get_instance_var("gh_fall");
	if(.@var == 11){
		cutin "gl_barmund2",2;
		mes "[ Varmundt ]";
		mes "If I had chased a little more, I'd have caught up with him. I was worried about our king, I couldn't help but coming here myself.";
		next;
		cutin "schmidt04",0;
		mes "[ Schmidt ]";
		mes "Master...";
		next;
		cutin "gl_barmund3",2;
		mes "[ Varmundt ]";
		mes "What the hell are you doing Heinrich! I ordered you to ensure that the King wouldn't come here.";
		next;
		cutin "heinrich02",2;
		mes "[ Heinrich ]";
		mes "I'll evacuate Schmidt right away!";
		next;
		cutin "gl_barmund2",2;
		mes "[ Varmundt ]";
		mes "That's what I thought. I'll take care of the orb, so evacuate the castle immediately.";
		close2;
		cutin "",255;
		instance_hide("Varmundt#gh_fall_1",true);
		instance_enable("Varmundt#gh_fall_1",false);
		set_instance_var("gh_fall",12);
		end;
	}
	end;
}

1@gl_prq,299,297,4	script	Oscar#gh_fall_1	4_ED_OSCAR,{
	.@map$ = get_instance_var("map$");
	.@var = get_instance_var("gh_fall");
	if(.@var == 13){
		cutin "OSCAR01",2;
		mes "[ Oscar ]";
		mes "I think I've seen this happen about 824000 times.";
		next;
		mes "[ Oscar ]";
		mes "Sometimes I fall into another area, but the dimensions that you are able to see now are nothing but history.";
		next;
		cutin "OSCAR03",2;
		mes "[ Oscar ]";
		mes "For the time being, we must break through the dimensions and observe Schmidt's story. The timeline from now on is very dangerous.";
		next;
		mes "[ Oscar ]";
		mes "Schmidt nor Heinrich probably won't be able to detect you, even if Heinrich is a master of magic reconstruction.";
		next;
		mes "[ Oscar ]";
		mes "So, are you going to follow Schmidt and see what happens next? If you are not interested, you can stop here.";
		next;
		if(select("Hang on.:I'll go") == 1){
			mes "[ Oscar ]";
			mes "Well, that's your decision. People's interest are different I guess.";
			close3;
		}
		cutin "OSCAR01",2;
		mes "[ Oscar ]";
		mes "Good decision. Once you see it, you'll want to witness it until the end.";
		close2;
		cutin "",255;
		instance_enable("#gh_fall_ev_2",true);
		instance_enable("Orb#edda_fall_0",true);
		instance_enable("Varmundt#gh_fall_2",true);
		instance_hide("Varmundt#gh_fall_2",false);
		set_instance_var("gh_fall",14);
		warp .@map$,52,275;
	}
	end;
}


1@gl_prq,303,296,3	duplicate(dummynpc2)	#gh_fall_guard_0	4_F_KHALITZBURG
1@gl_prq,303,294,3	duplicate(dummynpc2)	#gh_fall_guard_1	4_F_KHALITZBURG
1@gl_prq,303,292,3	duplicate(dummynpc2)	#gh_fall_guard_2	4_F_KHALITZBURG
1@gl_prq,305,296,7	duplicate(dummynpc2)	#gh_fall_guard_3	4_F_KHALITZBURG
1@gl_prq,305,294,6	duplicate(dummynpc2)	#gh_fall_guard_4	4_F_KHALITZBURG
1@gl_prq,305,292,1	duplicate(dummynpc2)	#gh_fall_guard_5	4_F_KHALITZBURG

1@gl_prq,52,282,4	duplicate(dummynpc2)	#schmidt_dummy_0	4_ED_SCHMIDT
1@gl_prq,52,281,4	duplicate(dummynpc2)	#schmidt_dummy_1	4_ED_SCHMIDT
1@gl_prq,52,280,4	duplicate(dummynpc2)	#schmidt_dummy_2	4_ED_SCHMIDT
1@gl_prq,52,279,4	duplicate(dummynpc2)	#schmidt_dummy_3	4_ED_SCHMIDT
1@gl_prq,52,278,4	duplicate(dummynpc2)	#schmidt_dummy_4	4_ED_SCHMIDT
1@gl_prq,52,277,4	duplicate(dummynpc2)	#schmidt_dummy_5	4_ED_SCHMIDT
1@gl_prq,52,276,4	duplicate(dummynpc2)	#schmidt_dummy_6	4_ED_SCHMIDT
1@gl_prq,52,275,4	duplicate(dummynpc2)	#schmidt_dummy_7	4_ED_SCHMIDT
1@gl_prq,52,274,4	duplicate(dummynpc2)	#schmidt_dummy_8	4_ED_SCHMIDT
1@gl_prq,52,273,4	duplicate(dummynpc2)	#schmidt_dummy_9	4_ED_SCHMIDT
1@gl_prq,52,272,4	duplicate(dummynpc2)	#schmidt_dummy_10	4_ED_SCHMIDT
1@gl_prq,47,277,6	duplicate(dummynpc2)	#schmidt_dummy_11	4_ED_SCHMIDT
1@gl_prq,48,277,6	duplicate(dummynpc2)	#schmidt_dummy_12	4_ED_SCHMIDT
1@gl_prq,49,277,6	duplicate(dummynpc2)	#schmidt_dummy_13	4_ED_SCHMIDT
1@gl_prq,50,277,6	duplicate(dummynpc2)	#schmidt_dummy_14	4_ED_SCHMIDT
1@gl_prq,51,277,6	duplicate(dummynpc2)	#schmidt_dummy_15	4_ED_SCHMIDT
1@gl_prq,52,277,6	duplicate(dummynpc2)	#schmidt_dummy_16	4_ED_SCHMIDT
1@gl_prq,53,277,6	duplicate(dummynpc2)	#schmidt_dummy_17	4_ED_SCHMIDT
1@gl_prq,54,277,6	duplicate(dummynpc2)	#schmidt_dummy_18	4_ED_SCHMIDT
1@gl_prq,55,277,6	duplicate(dummynpc2)	#schmidt_dummy_19	4_ED_SCHMIDT
1@gl_prq,56,277,6	duplicate(dummynpc2)	#schmidt_dummy_20	4_ED_SCHMIDT
1@gl_prq,57,277,6	duplicate(dummynpc2)	#schmidt_dummy_21	4_ED_SCHMIDT
1@gl_prq,52,272,8	duplicate(dummynpc2)	#schmidt_dummy_22	4_ED_SCHMIDT
1@gl_prq,52,273,8	duplicate(dummynpc2)	#schmidt_dummy_23	4_ED_SCHMIDT
1@gl_prq,52,274,8	duplicate(dummynpc2)	#schmidt_dummy_24	4_ED_SCHMIDT
1@gl_prq,52,275,8	duplicate(dummynpc2)	#schmidt_dummy_25	4_ED_SCHMIDT
1@gl_prq,52,276,8	duplicate(dummynpc2)	#schmidt_dummy_26	4_ED_SCHMIDT
1@gl_prq,52,277,8	duplicate(dummynpc2)	#schmidt_dummy_27	4_ED_SCHMIDT
1@gl_prq,52,278,8	duplicate(dummynpc2)	#schmidt_dummy_28	4_ED_SCHMIDT
1@gl_prq,52,279,8	duplicate(dummynpc2)	#schmidt_dummy_29	4_ED_SCHMIDT
1@gl_prq,52,280,8	duplicate(dummynpc2)	#schmidt_dummy_30	4_ED_SCHMIDT
1@gl_prq,52,281,8	duplicate(dummynpc2)	#schmidt_dummy_31	4_ED_SCHMIDT
1@gl_prq,52,282,8	duplicate(dummynpc2)	#schmidt_dummy_32	4_ED_SCHMIDT
1@gl_prq,57,277,2	duplicate(dummynpc2)	#schmidt_dummy_33	4_ED_SCHMIDT
1@gl_prq,56,277,2	duplicate(dummynpc2)	#schmidt_dummy_34	4_ED_SCHMIDT
1@gl_prq,55,277,2	duplicate(dummynpc2)	#schmidt_dummy_35	4_ED_SCHMIDT
1@gl_prq,54,277,2	duplicate(dummynpc2)	#schmidt_dummy_36	4_ED_SCHMIDT
1@gl_prq,53,277,2	duplicate(dummynpc2)	#schmidt_dummy_37	4_ED_SCHMIDT
1@gl_prq,52,277,2	duplicate(dummynpc2)	#schmidt_dummy_38	4_ED_SCHMIDT
1@gl_prq,51,277,2	duplicate(dummynpc2)	#schmidt_dummy_39	4_ED_SCHMIDT
1@gl_prq,50,277,2	duplicate(dummynpc2)	#schmidt_dummy_40	4_ED_SCHMIDT
1@gl_prq,49,277,2	duplicate(dummynpc2)	#schmidt_dummy_41	4_ED_SCHMIDT
1@gl_prq,48,277,2	duplicate(dummynpc2)	#schmidt_dummy_42	4_ED_SCHMIDT
1@gl_prq,47,277,2	duplicate(dummynpc2)	#schmidt_dummy_43	4_ED_SCHMIDT


1@gl_prq	mapflag	noteleport	1